package v1

import (
	context "context"
)

type RegistrationORM struct {
	Consumers   []*ConsumerORM `gorm:"foreignkey:Id;association_foreignkey:Id;many2many:registration_consumers;jointable_foreignkey:RegistrationId;association_jointable_foreignkey:ConsumerId"`
	Description string
	Domain      string      `gorm:"uniqueIndex:idx"`
	Id          string      `gorm:"type:uuid;primary_key"`
	Name        string      `gorm:"uniqueIndex:idx"`
	Routes      []*RouteORM `gorm:"foreignkey:RegistrationId;association_foreignkey:Id"`
	Status      int32
	Version     string `gorm:"uniqueIndex:idx"`
}

// TableName overrides the default tablename generated by GORM
func (RegistrationORM) TableName() string {
	return "registrations"
}

// ToORM runs the BeforeToORM hook if present, converts the fields of this
// object to ORM format, runs the AfterToORM hook, then returns the ORM object
func (m *Registration) ToORM(ctx context.Context) (RegistrationORM, error) {
	to := RegistrationORM{}
	var err error
	if prehook, ok := interface{}(m).(RegistrationWithBeforeToORM); ok {
		if err = prehook.BeforeToORM(ctx, &to); err != nil {
			return to, err
		}
	}
	to.Id = m.Id
	to.Domain = m.Domain
	to.Name = m.Name
	to.Version = m.Version
	to.Description = m.Description
	to.Status = int32(m.Status)
	for _, v := range m.Routes {
		if v != nil {
			if tempRoutes, cErr := v.ToORM(ctx); cErr == nil {
				to.Routes = append(to.Routes, &tempRoutes)
			} else {
				return to, cErr
			}
		} else {
			to.Routes = append(to.Routes, nil)
		}
	}
	for _, v := range m.Consumers {
		if v != nil {
			if tempConsumers, cErr := v.ToORM(ctx); cErr == nil {
				to.Consumers = append(to.Consumers, &tempConsumers)
			} else {
				return to, cErr
			}
		} else {
			to.Consumers = append(to.Consumers, nil)
		}
	}
	if posthook, ok := interface{}(m).(RegistrationWithAfterToORM); ok {
		err = posthook.AfterToORM(ctx, &to)
	}
	return to, err
}

// ToPB runs the BeforeToPB hook if present, converts the fields of this
// object to PB format, runs the AfterToPB hook, then returns the PB object
func (m *RegistrationORM) ToPB(ctx context.Context) (Registration, error) {
	to := Registration{}
	var err error
	if prehook, ok := interface{}(m).(RegistrationWithBeforeToPB); ok {
		if err = prehook.BeforeToPB(ctx, &to); err != nil {
			return to, err
		}
	}
	to.Id = m.Id
	to.Domain = m.Domain
	to.Name = m.Name
	to.Version = m.Version
	to.Description = m.Description
	to.Status = ServiceStatus(m.Status)
	for _, v := range m.Routes {
		if v != nil {
			if tempRoutes, cErr := v.ToPB(ctx); cErr == nil {
				to.Routes = append(to.Routes, &tempRoutes)
			} else {
				return to, cErr
			}
		} else {
			to.Routes = append(to.Routes, nil)
		}
	}
	for _, v := range m.Consumers {
		if v != nil {
			if tempConsumers, cErr := v.ToPB(ctx); cErr == nil {
				to.Consumers = append(to.Consumers, &tempConsumers)
			} else {
				return to, cErr
			}
		} else {
			to.Consumers = append(to.Consumers, nil)
		}
	}
	if posthook, ok := interface{}(m).(RegistrationWithAfterToPB); ok {
		err = posthook.AfterToPB(ctx, &to)
	}
	return to, err
}

// The following are interfaces you can implement for special behavior during ORM/PB conversions
// of type Registration the arg will be the target, the caller the one being converted from

// RegistrationBeforeToORM called before default ToORM code
type RegistrationWithBeforeToORM interface {
	BeforeToORM(context.Context, *RegistrationORM) error
}

// RegistrationAfterToORM called after default ToORM code
type RegistrationWithAfterToORM interface {
	AfterToORM(context.Context, *RegistrationORM) error
}

// RegistrationBeforeToPB called before default ToPB code
type RegistrationWithBeforeToPB interface {
	BeforeToPB(context.Context, *Registration) error
}

// RegistrationAfterToPB called after default ToPB code
type RegistrationWithAfterToPB interface {
	AfterToPB(context.Context, *Registration) error
}

type RouteORM struct {
	Host           string
	Id             string `gorm:"type:uuid;primary_key"`
	Kind           int32
	Path           string `gorm:"uniqueIndex:idx"`
	Port           int32
	RegistrationId *string
}

// TableName overrides the default tablename generated by GORM
func (RouteORM) TableName() string {
	return "routes"
}

// ToORM runs the BeforeToORM hook if present, converts the fields of this
// object to ORM format, runs the AfterToORM hook, then returns the ORM object
func (m *Route) ToORM(ctx context.Context) (RouteORM, error) {
	to := RouteORM{}
	var err error
	if prehook, ok := interface{}(m).(RouteWithBeforeToORM); ok {
		if err = prehook.BeforeToORM(ctx, &to); err != nil {
			return to, err
		}
	}
	to.Id = m.Id
	to.Path = m.Path
	to.Host = m.Host
	to.Port = m.Port
	to.Kind = int32(m.Kind)
	if posthook, ok := interface{}(m).(RouteWithAfterToORM); ok {
		err = posthook.AfterToORM(ctx, &to)
	}
	return to, err
}

// ToPB runs the BeforeToPB hook if present, converts the fields of this
// object to PB format, runs the AfterToPB hook, then returns the PB object
func (m *RouteORM) ToPB(ctx context.Context) (Route, error) {
	to := Route{}
	var err error
	if prehook, ok := interface{}(m).(RouteWithBeforeToPB); ok {
		if err = prehook.BeforeToPB(ctx, &to); err != nil {
			return to, err
		}
	}
	to.Id = m.Id
	to.Path = m.Path
	to.Host = m.Host
	to.Port = m.Port
	to.Kind = ProtocolKind(m.Kind)
	if posthook, ok := interface{}(m).(RouteWithAfterToPB); ok {
		err = posthook.AfterToPB(ctx, &to)
	}
	return to, err
}

// The following are interfaces you can implement for special behavior during ORM/PB conversions
// of type Route the arg will be the target, the caller the one being converted from

// RouteBeforeToORM called before default ToORM code
type RouteWithBeforeToORM interface {
	BeforeToORM(context.Context, *RouteORM) error
}

// RouteAfterToORM called after default ToORM code
type RouteWithAfterToORM interface {
	AfterToORM(context.Context, *RouteORM) error
}

// RouteBeforeToPB called before default ToPB code
type RouteWithBeforeToPB interface {
	BeforeToPB(context.Context, *Route) error
}

// RouteAfterToPB called after default ToPB code
type RouteWithAfterToPB interface {
	AfterToPB(context.Context, *Route) error
}

type ConsumerORM struct {
	AggregateType string `gorm:"uniqueIndex:idx"`
	EventCode     string `gorm:"uniqueIndex:idx"`
	EventType     string `gorm:"uniqueIndex:idx"`
	Id            string `gorm:"type:uuid;primary_key"`
	Kind          int32
}

// TableName overrides the default tablename generated by GORM
func (ConsumerORM) TableName() string {
	return "consumers"
}

// ToORM runs the BeforeToORM hook if present, converts the fields of this
// object to ORM format, runs the AfterToORM hook, then returns the ORM object
func (m *Consumer) ToORM(ctx context.Context) (ConsumerORM, error) {
	to := ConsumerORM{}
	var err error
	if prehook, ok := interface{}(m).(ConsumerWithBeforeToORM); ok {
		if err = prehook.BeforeToORM(ctx, &to); err != nil {
			return to, err
		}
	}
	to.Id = m.Id
	to.AggregateType = m.AggregateType
	to.EventType = m.EventType
	to.EventCode = m.EventCode
	to.Kind = int32(m.Kind)
	if posthook, ok := interface{}(m).(ConsumerWithAfterToORM); ok {
		err = posthook.AfterToORM(ctx, &to)
	}
	return to, err
}

// ToPB runs the BeforeToPB hook if present, converts the fields of this
// object to PB format, runs the AfterToPB hook, then returns the PB object
func (m *ConsumerORM) ToPB(ctx context.Context) (Consumer, error) {
	to := Consumer{}
	var err error
	if prehook, ok := interface{}(m).(ConsumerWithBeforeToPB); ok {
		if err = prehook.BeforeToPB(ctx, &to); err != nil {
			return to, err
		}
	}
	to.Id = m.Id
	to.AggregateType = m.AggregateType
	to.EventType = m.EventType
	to.EventCode = m.EventCode
	to.Kind = ConsumerKind(m.Kind)
	if posthook, ok := interface{}(m).(ConsumerWithAfterToPB); ok {
		err = posthook.AfterToPB(ctx, &to)
	}
	return to, err
}

// The following are interfaces you can implement for special behavior during ORM/PB conversions
// of type Consumer the arg will be the target, the caller the one being converted from

// ConsumerBeforeToORM called before default ToORM code
type ConsumerWithBeforeToORM interface {
	BeforeToORM(context.Context, *ConsumerORM) error
}

// ConsumerAfterToORM called after default ToORM code
type ConsumerWithAfterToORM interface {
	AfterToORM(context.Context, *ConsumerORM) error
}

// ConsumerBeforeToPB called before default ToPB code
type ConsumerWithBeforeToPB interface {
	BeforeToPB(context.Context, *Consumer) error
}

// ConsumerAfterToPB called after default ToPB code
type ConsumerWithAfterToPB interface {
	AfterToPB(context.Context, *Consumer) error
}
